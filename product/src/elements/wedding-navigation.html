<!-- general polymer elements -->
<link rel="import" href="/src/shared/shared-polymer-header.html">
<link rel="import" href="/bower_components/paper-menu-button/paper-menu-button.html">

<!-- other imports -->
<link rel="import" href="/src/shared/shared-jquery.html">

<dom-module id="wedding-navigation">
  <!-- Defines the element's style and local DOM -->
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        position: fixed;
        z-index: 1000;
        width: 100%;
        --wedding-nav-item-padding: 3px;
      }

      /*TODO: im moment überdeckt die Navigation den ganzen oberen Teil der Webseite so, dass man dort keine Links klicken kann!!!*/

      /** navigation */
      /* page-top-style */
      ul {
        list-style-type: none;
        padding: 0;
      }

      a {
        padding: inherit;
      }

      :host > ul > li {
        float: left;
        width: 20%;
        text-align: center;
        padding: var(--wedding-nav-item-padding);
      }

      :host > ul > li > ul {
        display: none;
      }

      :host > ul > li > ul > li {
        padding: var(--wedding-nav-item-padding);
      }

      /* page-scroll-style */
      :host > ul.scroll {
        float: right;
        width: 20%;
      }

      :host > ul > li.scroll {
        float: none;
        width: auto;
        text-align: right;
      }

      /* collapse-style */

      /** logo */
      .logo {
        display: inline-block;
        width: 40%;
      }

      img {
        width: 100%;
      }

      @media (max-width: 750px) {
        #nav {
          display: none;
        }
      }

    </style>

    <!-- local DOM -->
<!--TODO: wahrscheinlich muss ich da noch diese Elements importieren-->
    <paper-menu-button>
      <paper-icon-button icon="menu" class="dropdown-trigger"></paper-icon-button>
      <paper-menu class="dropdown-content">
        <paper-item>Share</paper-item>
        <paper-item>Settings</paper-item>
        <paper-item>Help</paper-item>
      </paper-menu>
    </paper-menu-button>

    <!-- TODO: Ohne Logo / Matter Balken als Hintergrund / ganz normeler dropdown hover -->
    <ul id="nav">

      <li id="logo">
        <a class="logo" href="/index.html"><img src="/src/image/chibi-logo.png" alt="Logo"></a>
      </li>

      <li id="nav-brautpaar">
        <a href="/brautpaar.html">Brautpaar</a>
        <ul>
          <li><a href="#geschichte">Geschichte</a></li>
          <li><a href="#braut">Braut</a></li>
          <li><a href="#braeutigam">Bräutigam</a></li>
          <!--<li><a href="#gallery">Bilder-Galerie</a></li>-->
        </ul>
      </li>

      <li id="nav-trauung">
        <a href="/trauung.html">Trauung</a>
        <ul>
          <li><a href="#zivil">Zivile Trauung</a></li>
          <li><a href="#kirchlich">Kirchliche Trauung</a></li>
          <li><a href="#festlichkeiten">Festlichkeiten</a></li>
        </ul>
      </li>

      <li id="nav-organisation">
        <a href="/organisation.html">Organisation</a>
        <ul>
          <li><a href="#trauzeugen">Trauzeugen</a></li>
          <li><a href="#ok">OK-Team</a></li>
          <li><a href="#helfer">Helfer</a></li>
        </ul>
      </li>

      <li id="nav-geschenke">
        <a href="/geschenke.html">Geschenke</a>
      </li>

      <li id="nav-anmeldung">
        <a href="/anmeldung.html">Anmeldung</a>
      </li>

    </ul>


  </template>
  <!-- Creates the element's prototype and registers it -->
  <script>
    Polymer({
      is: 'wedding-navigation',

      ready: function () {
        /** general */
        /* Variables */
        var url = window.location.pathname,
          filename = url.substring(url.lastIndexOf('/') + 1),
          fileString = filename.substring(0, filename.lastIndexOf('.')),
          fileStringWithoutDash = fileString.lastIndexOf('-') > 0 ? fileString.substring(0, fileString.lastIndexOf('-')) : fileString,
          $mainItem = $(this.querySelector('#nav-' + fileStringWithoutDash)),
          $logo = $(this.$.logo),
          $subItemList = $mainItem.children('ul'),
          $nav = $(this.$.nav),
          $navChildren = $nav.children(),
          navHalf = $navChildren.length / 2;

        /* hide the current main nav item depending on the filename.
         * even if the filename is extended with "-something", it will grap just the first word.
         * That way, it's possible to build a "page-something.html" as background-page of "page.html*/
        $mainItem.hide();

        /* add the current sub-items to the logo and show them */
        $logo.append($subItemList);
        $subItemList.css('display', 'block');

        /** on page-top */
        /* move the logo to the center */
        setLogo(navHalf, $mainItem, $logo);


        /** on page-scroll */
        /* as soon as the user scrolls... */
        document.onscroll = function () {

          /* as soon as the scrollbar is more than 10px scrolled down.. */
          if (window.scrollY >= 10) {
            /* give the scroll-classes to the correct elements */
            for (var i = 0; i < $navChildren.length; i++) {
              $nav.addClass('scroll');
              $($navChildren[i]).addClass('scroll');
            }
            /* move the logo to first position */
            setLogo(0, $mainItem, $logo);

          } else { /* if the scrollbar goes back to less than 10px scrolled down.. */
            /* remove the scroll-classes again */
            for (var ii = 0; ii < $navChildren.length; ii++) {
              $nav.removeClass('scroll');
              $($navChildren[ii]).removeClass('scroll');
            }
            /* move the logo back to center */
            setLogo(navHalf, $mainItem, $logo);
          }
        };

        /* set the current sub-items circular */
//        var $subItems = $subItemList.children();
//        $($subItems[0]).css('transform', 'translate(-50%, -250%)');
//        $($subItems[1]).css('transform', 'translate(0, -200%)');
//        $($subItems[2]).css('transform', 'translate(50%, -450%)');
//

        /** FUNCTIONS */
        /**
         *
         * @param position
         * @param $mainItem
         * @param $logo
         */
        function setLogo(position, $mainItem, $logo) {
          if ($mainItem.index() <= position) {
            $($logo.parent().children()[(position)]).after($logo);
          } else {
            $($logo.parent().children()[(position)]).before($logo);
          }

        }
      }


    });
  </script>
</dom-module>