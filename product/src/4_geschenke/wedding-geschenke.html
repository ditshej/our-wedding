<link rel="import" href="/bower_components/polymer/polymer.html">

<link rel="import" href="/src/elements/wedding-navigation.html">
<link rel="import" href="/src/elements/wedding-eyecatcher.html">
<link rel="import" href="/src/elements/wedding-present.html">

<link rel="import" href="/src/shared/shared-jquery.html">

<dom-module id="wedding-geschenke">
  <template>
    <style>
      :host {
        display: block;
      }

      #present-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
      }

      wedding-present {
        width: 400px;
      }

      /* helpclass to hide */
      .hidden {
        display: none;
      }

    </style>

    <wedding-navigation></wedding-navigation>
    <wedding-eyecatcher title="Geschenke"
                        img="https://placeimg.com/1280/900/any/sepia"></wedding-eyecatcher>

    <div id="present-container"></div>

  </template>

  <script>
    Polymer({
      is: 'wedding-geschenke',

      ready: function () {

        /** ajax request to get presents-data form "/getpresent" in json */
        $.ajax('/getpresent', {
          type: 'GET',
          contentType: 'json',
          success: function (data) {
            /* Create <wedding-present>-Elements with given Data */
            createPresents(data);
          },
          error: function () {
            console.log('error');
          }
        });


        /**
         * Create <wedding-present>-Elements with given Data
         * @param presentsArray (array) Array with objects{ title, description, cost, img }
         */
        var createPresents = function createPresents(presentsArray) {
          /* fetch the DOM-Element to put the <wedding-present>-Elemenets in */
          var $presentContainer = $('#present-container');

          /* for every Element in the given presentArray create a <wedding-present>-Element and add it to the Container */
          for (var i = 0; i < presentsArray.length; i++) {
            /* create class to hide element, if sold is set to true in presentArray */
            var sold = presentsArray[i].sold ? ' hidden' : undefined,
                    /* define <wedding-present>-Element */
              $weddingPresentElement = $('<wedding-present></wedding-present>', {
                id: presentsArray[i].id,
                title: presentsArray[i].title,
                img: presentsArray[i].img,
                imgalt: presentsArray[i].img.slice(0, -4),
                description: presentsArray[i].description,
                cost: presentsArray[i].cost,
                class: 'scope-style wedding-geschenke' + sold
              });
            /* append <wedding-present>-Element to the Container */
            $presentContainer.append($weddingPresentElement);
          }
        };


      }

    });
  </script>
</dom-module>