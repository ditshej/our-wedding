<dom-module id="dj-sub-pages">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <!-- ROUTE -->
    <!-- define routing parameters
      -- https://beta.webcomponents.org/element/PolymerElements/app-route/app-route -->
    <app-route route="{{route}}"
               pattern="/:subpage"
               active="{{subpageActive}}"
               data="{{subpageData}}"></app-route>

    <!-- CONTENT -->
    <div id="main">
      <!-- all subpages will be added here with javascript -->
    </div>

  </template>

  <script>
    Polymer({
      is: 'dj-sub-pages',

      properties: {
        /* variable for current subpage */
        subpage: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged'
        },
        /* variable for the MainPage */
        dataPage: {
          type: String
        }
      },

      observers: [
        '_routePageChanged(subpageData.subpage)'
      ],

      /* as soon as the subpageData.page changes (the navigation is used to show other subpage), this function will be executed */
      _routePageChanged: function (subpage) {
        /* the page-variable will be set to the new page (data-page-attribute of selected sub-navigation point) */
        this.subpage = subpage || 'starter';
      },

      /* as soon as the subpage variable changes, this function will be executed */
      _pageChanged: function (subpage) {
        /* jump to its page-section, when subpage is clicked */
        var scrollId = this.querySelector('#' + subpage);
        if (scrollId) { /* "if" is needed to ignore the unloaded <dj-sub-pages> */
          scrollId.scrollIntoView();
        }
        //TODO: Page should also be scrolled when page is reloaded or when the link is just clicked a secon time while same load
      },


      /**
       * create Page
       * As soon as the DOM is loaded, the ready-function will be executed.
       *
       * For every subpage an html-element will be added with the following structure:
       * 'our-' + mainPage + '-' + item + '.html'
       *
       * This allows to implement an polymer-element with that name.
       * One only need to create it with the correct name.
       * example: our-brautpaar-braut.html
       *
       * needed Input to set up when the <dj-sub-pages> element is defined:
       * - dataPage (String): Information about the MainPage -- added by "data-page"-attribute
       * - items (Object): Subpage-Names -- added by "items"-attribute
       */
      ready: function (subpage) {
        /* for every item in the items-Object (this.items) the section of that item will be created */
        for (var x = 0, y = this.items.length; x < y; x += 1) {
          var mainPage = this.dataPage,
            item = this.items[x];

          /* create html-import */
          var resolvedPageUrl = this.resolveUrl('our-' + mainPage + '-' + item + '.html');
          this.importHref(resolvedPageUrl, null, null, true);

          /* add a div to the <dj-sub-pages> element
           * - id = item-name
           * - class = "page-section" for styling
           * and add the item's element to that div */
          var containerElement = document.createElement('div'),
            dynamicElement = document.createElement('our-' + mainPage + '-' + item);
          containerElement.id = item;
          containerElement.className = 'page-section';
          containerElement.appendChild(dynamicElement);
          Polymer.dom(this.$.main).appendChild(containerElement);
        }
      }
    });
  </script>
</dom-module>